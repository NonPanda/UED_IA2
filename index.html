<!DOCTYPE html>
<!-- Set base font size for rem calculations. This will be scaled. -->
<html lang="en" style="font-size: 16px;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessible Form Redesign</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">

</head>
<body class="bg-gray-100 text-gray-800">

    <nav class="a11y-toolbar sticky top-0 z-50 bg-white shadow-md flex justify-between items-center transition-colors duration-300">
        <div class="text-lg font-semibold text-gray-700" style="font-size: 18px;">Accessibility Controls</div>
        <div class="flex items-center space-x-2">
            <button id="font-decrease" aria-label="Decrease font size" class="a11y-button p-2 rounded-lg hover:bg-gray-200 transition-colors">
                <svg class="w-6 h-6 fill-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 11V13H19V11H5Z"/></svg>
            </button>
            <button id="font-increase" aria-label="Increase font size" class="a11y-button p-2 rounded-lg hover:bg-gray-200 transition-colors">
                <svg class="w-6 h-6 fill-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"/></svg>
            </button>
            <button id="contrast-toggle" aria-label="Toggle high contrast mode" class="a11y-button p-2 rounded-lg hover:bg-gray-200 transition-colors">
                <svg class="w-6 h-6 fill-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 20V4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20Z"/></svg>
            </button>
        </div>
    </nav>

    <main class="py-12 px-4">
        
        <div class="form-container max-w-2xl mx-auto bg-white p-8 md:p-12 rounded-lg shadow-xl transition-colors duration-300">
            
            <header class="mb-8 border-b pb-6">
                <h1 class="form-title text-3xl font-bold text-gray-900 mb-2">Feedback Form Redesign</h1>
                <p class="form-description text-lg text-gray-600">Please provide your valuable feedback to help us improve.</p>
            </header>

            <div class="mb-8">
                <div id="nav-counter" class="nav-counter text-right text-sm font-semibold text-gray-600 mb-1">
                    Question 1 / 3
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar-inner"></div>
                </div>
            </div>

            <form id="accessible-form" novalidate>
                <div id="q1" class="question-block mb-8">
                    <label for="email" class="flex items-center text-xl font-semibold text-gray-800 mb-3">
                        <span class="mr-2">1.</span>
                        Email Address
                        <span class="text-red-600 ml-1">*</span>
                        <button type="button" class="speak-button ml-auto p-1 rounded-full hover:bg-gray-200" aria-label="Read question aloud">
                            <svg class="w-5 h-5 fill-gray-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9V15H7L12 20V4L7 9H3ZM16.5 12C16.5 10.23 15.5 8.71 14 7.97V16.02C15.5 15.29 16.5 13.77 16.5 12ZM14 3.23V5.29C16.89 6.15 19 8.83 19 12C19 15.17 16.89 17.84 14 18.7V20.77C18.01 19.86 21 16.28 21 12C21 7.72 18.01 4.14 14 3.23Z"/></svg>
                        </button>
                    </label>
                    <input type="email" id="email" name="email" class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all" required>
                    <div id="email-error" class="error-message" role="alert">Please enter a valid email address.</div>
                </div>

                <div id="q2" class="question-block mb-8">
                    <fieldset>
                        <legend class="flex items-center text-xl font-semibold text-gray-800 mb-3">
                            <span class="mr-2">2.</span>
                            How was your experience?
                            <span class="text-red-600 ml-1">*</span>
                            <button type="button" class="speak-button ml-auto p-1 rounded-full hover:bg-gray-200" aria-label="Read question aloud">
                                <svg class="w-5 h-5 fill-gray-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9V15H7L12 20V4L7 9H3ZM16.5 12C16.5 10.23 15.5 8.71 14 7.97V16.02C15.5 15.29 16.5 13.77 16.5 12ZM14 3.23V5.29C16.89 6.15 19 8.83 19 12C19 15.17 16.89 17.84 14 18.7V20.77C18.01 19.86 21 16.28 21 12C21 7.72 18.01 4.14 14 3.23Z"/></svg>
                            </button>
                        </legend>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <input type="radio" id="exp-good" name="experience" value="good" class="w-5 h-5 text-blue-600 border-gray-300 focus:ring-blue-500" required>
                                <label for="exp-good" class="ml-3 block text-lg text-gray-700">Good</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" id="exp-neutral" name="experience" value="neutral" class="w-5 h-5 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <label for="exp-neutral" class="ml-3 block text-lg text-gray-700">Neutral</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" id="exp-bad" name="experience" value="bad" class="w-5 h-5 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <label for="exp-bad" class="ml-3 block text-lg text-gray-700">Bad</label>
                            </div>
                        </div>
                        <div id="experience-error" class="error-message" role="alert">Please select an option.</div>
                    </fieldset>
                </div>

                <div id="q3" class="question-block mb-8">
                    <label for="feedback" class="flex items-center text-xl font-semibold text-gray-800 mb-3">
                        <span class="mr-2">3.</span>
                        Any additional feedback?
                        <button type="button" class="speak-button ml-auto p-1 rounded-full hover:bg-gray-200" aria-label="Read question aloud">
                            <svg class="w-5 h-5 fill-gray-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9V15H7L12 20V4L7 9H3ZM16.5 12C16.5 10.23 15.5 8.71 14 7.97V16.02C15.5 15.29 16.5 13.77 16.5 12ZM14 3.23V5.29C16.89 6.15 19 8.83 19 12C19 15.17 16.89 17.84 14 18.7V20.77C18.01 19.86 21 16.28 21 12C21 7.72 18.01 4.14 14 3.23Z"/></svg>
                        </button>
                    </label>
                    <textarea id="feedback" name="feedback" rows="4" class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></textarea>
                </div>

                <div class="mt-12 text-center flex justify-center gap-4">
                    <button type="button" id="clear-button" class="bg-gray-500 text-white text-lg font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all">Clear All</button>
                    <button type="submit" class="submit-button bg-blue-600 text-white text-lg font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all">Submit Feedback</button>
                </div>
            </form>
        </div>
    </main>

    <div class="fixed bottom-6 right-6 z-40 flex flex-col items-center space-y-2">
        <button id="nav-up" aria-label="Previous question" class="nav-button bg-white p-3 rounded-full shadow-lg hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            <svg class="w-6 h-6 fill-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.9999 10.8284L7.0502 15.7781L5.63599 14.3639L11.9999 8L18.3639 14.3639L16.9497 15.7781L11.9999 10.8284Z"/></svg>
        </button>
        <button id="nav-down" aria-label="Next question" class="nav-button bg-white p-3 rounded-full shadow-lg hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            <svg class="w-6 h-6 fill-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 16L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"/></svg>
        </button>
    </div>

    <div id="message-box-overlay" class="message-box-overlay">
        <div id="message-box" class="message-box">
            <span id="message-box-close" class="message-box-close">&times;</span>
            <p id="message-box-text"></p>
        </div>
    </div>
    
    <div id="toast-message" class="toast-message">
        <svg class="w-6 h-6 fill-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 15.172L19.192 5.979L20.607 7.393L10 18L3.393 11.393L4.808 9.979L10 15.172Z"/></svg>
        <span id="toast-text">Progress saved!</span>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('accessible-form');
            const emailInput = document.getElementById('email');
            const experienceRadios = document.querySelectorAll('input[name="experience"]');
            const feedbackInput = document.getElementById('feedback');
            

            const fontIncreaseBtn = document.getElementById('font-increase');
            const fontDecreaseBtn = document.getElementById('font-decrease');
            const contrastToggleBtn = document.getElementById('contrast-toggle');

            let currentHtmlFontSize = 16;
            function updateRootFontSize(newSize) {
                currentHtmlFontSize = Math.max(12, Math.min(24, newSize));
                document.documentElement.style.fontSize = `${currentHtmlFontSize}px`;
            }

            fontIncreaseBtn.addEventListener('click', () => updateRootFontSize(currentHtmlFontSize + 2));
            fontDecreaseBtn.addEventListener('click', () => updateRootFontSize(currentHtmlFontSize - 2));
            
            contrastToggleBtn.addEventListener('click', () => {
                document.body.classList.toggle('high-contrast');
            });

            const speakButtons = document.querySelectorAll('.speak-button');
            const synth = window.speechSynthesis;

            speakButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const questionBlock = button.closest('.question-block');
                    if (!questionBlock) return;

                    const headerElement = questionBlock.querySelector('label, legend');
                    let textToSpeak = '';

                    if (headerElement) {
                        const clone = headerElement.cloneNode(true);
                        
                        const buttonInClone = clone.querySelector('.speak-button');
                        if (buttonInClone) {
                            buttonInClone.remove();
                        }
                        
                        const numberSpan = clone.querySelector('.mr-2');
                        if (numberSpan) {
                            numberSpan.remove();
                        }
                        
                        const asteriskSpan = clone.querySelector('.text-red-600');
                        if (asteriskSpan) {
                            asteriskSpan.remove();
                        }

                        textToSpeak = clone.textContent.trim();
                    } else {
                        console.warn("Could not find label or legend for speak button.");
                    }

                    if (synth.speaking) {
                        synth.cancel();
                    }
                    
                    if (textToSpeak) {
                        const utterance = new SpeechSynthesisUtterance(textToSpeak);
                        utterance.lang = "en-US";
                        synth.speak(utterance);
                    }
                });
            });

            const messageBoxOverlay = document.getElementById('message-box-overlay');
            const messageBoxText = document.getElementById('message-box-text');
            const messageBoxClose = document.getElementById('message-box-close');

            function showMessageBox(message) {
                messageBoxText.textContent = message;
                messageBoxOverlay.style.display = 'flex';
                messageBoxText.setAttribute('role', 'alert');
            }

            messageBoxClose.addEventListener('click', () => {
                messageBoxOverlay.style.display = 'none';
                messageBoxText.removeAttribute('role');
            });
            messageBoxOverlay.addEventListener('click', (e) => {
                if (e.target === messageBoxOverlay) {
                    messageBoxOverlay.style.display = 'none';
                    messageBoxText.removeAttribute('role');
                }
            });
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                let isValid = validateForm();
                
                if (isValid) {
                    showMessageBox("Form submitted successfully! (This is a demo)");
                    localStorage.removeItem('formProgress');
                } else {
                    showMessageBox("Please correct the errors on the form.");
                }
            });

            function validateForm() {
                let isValid = true;
                
                const emailError = document.getElementById('email-error');
                if (!emailInput.value || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value)) {
                    emailError.style.display = 'block';
                    isValid = false;
                } else {
                    emailError.style.display = 'none';
                }

                const experienceError = document.getElementById('experience-error');
                const checkedExperience = document.querySelector('input[name="experience"]:checked');
                if (!checkedExperience) {
                    experienceError.style.display = 'block';
                    isValid = false;
                } else {
                    experienceError.style.display = 'none';
                }

                return isValid;
            }

            const questions = document.querySelectorAll('.question-block');
            const navUpBtn = document.getElementById('nav-up');
            const navDownBtn = document.getElementById('nav-down');
            const navCounter = document.getElementById('nav-counter');
            const progressBar = document.getElementById('progress-bar');
            let currentQuestionIndex = 0;
            const totalQuestions = questions.length;

            function updateNav(index) {
                currentQuestionIndex = index;
                navCounter.textContent = `Question ${index + 1} / ${totalQuestions}`;
                
                navUpBtn.disabled = (index === 0);
                navDownBtn.disabled = (index === totalQuestions - 1);
                
                const progressPercent = ((index + 1) / totalQuestions) * 100;
                progressBar.style.width = `${progressPercent}%`;
                
                questions.forEach((q, i) => {
                    q.classList.toggle('active', i === index);
                });
            }

            function scrollToQuestion(index, smooth = true) {
                if (questions[index]) {
                    questions[index].scrollIntoView({ 
                        behavior: smooth ? 'smooth' : 'auto', 
                        block: 'center' 
                    });
                    
                    const firstInput = questions[index].querySelector('input, textarea');
                    if (firstInput) {
                        firstInput.focus();
                    }
                    updateNav(index);
                }
            }

            navUpBtn.addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    scrollToQuestion(currentQuestionIndex - 1);
                }
            });

            navDownBtn.addEventListener('click', () => {
                if (currentQuestionIndex < totalQuestions - 1) {
                    scrollToQuestion(currentQuestionIndex + 1);
                }
            });

            questions.forEach((q, index) => {
                q.addEventListener('focusin', () => {
                    updateNav(index);
                });
            });

            const toastMessage = document.getElementById('toast-message');
            const toastText = document.getElementById('toast-text');
            let toastTimeout;

            function showToast(message) {
                if (toastText) {
                    toastText.textContent = message;
                }
                
                toastMessage.classList.add('show');
        
                clearTimeout(toastTimeout); 
                toastTimeout = setTimeout(() => {
                    toastMessage.classList.remove('show');
                }, 2000); 
            }

            let saveTimeout;
            function saveProgress() {
                const data = {
                    email: emailInput.value,
                    experience: document.querySelector('input[name="experience"]:checked')?.value || null,
                    feedback: feedbackInput.value
                };
                localStorage.setItem('formProgress', JSON.stringify(data));
                
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => showToast("Progress saved!"), 500);
            }

            function loadProgress() {
                const data = JSON.parse(localStorage.getItem('formProgress'));
                let wasRestored = false; 
                let activeIndex = 0;
                
                if (data) {
                    emailInput.value = data.email || '';
                    feedbackInput.value = data.feedback || '';
                    
                    if (data.email || data.feedback) { 
                        wasRestored = true;
                    }
                    
                    if (data.experience) {
                        const radioToCheck = document.querySelector(`input[name="experience"][value="${data.experience}"]`);
                        if (radioToCheck) {
                            radioToCheck.checked = true;
                            wasRestored = true; 
                        }
                    }
                    
                    if (data.feedback) {
                        activeIndex = 2;
                    } else if (data.experience) {
                        activeIndex = 1; 
                    } else if (data.email) {
                        activeIndex = 0; 
                    }
                }
                
                if (wasRestored) {
                    showToast("Progress restored!");
                }
                
                return activeIndex; 
            }
            form.addEventListener('input', saveProgress);
            
            const startingIndex = loadProgress();

            const clearButton = document.getElementById('clear-button');
            clearButton.addEventListener('click', () => {
                emailInput.value = '';
                feedbackInput.value = '';
                experienceRadios.forEach(radio => radio.checked = false);
                document.getElementById('email-error').style.display = 'none';
                document.getElementById('experience-error').style.display = 'none';
                localStorage.removeItem('formProgress');
                scrollToQuestion(0, true);
                showToast("Form cleared!");
            });

            if (startingIndex > 0) {
                 if (questions[startingIndex]) {
                    questions[startingIndex].scrollIntoView({ behavior: 'auto', block: 'center' }); 
                    
                    const firstInput = questions[startingIndex].querySelector('input, textarea');
                    if (firstInput) {
                        firstInput.focus();
                    }
                    
                    updateNav(startingIndex);
                }
            } else {
                updateNav(0);
            }

        });
    </script>
</body>
</html>

